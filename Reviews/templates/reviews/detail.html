<!-- reviews/templates/reviews/detail.html -->
{% extends "base.html" %}

{% block content %}
  <article class="review-detail container mt-4">
    <header class="mb-3">
      <h1 class="display-5">{{ review.title }}</h1>
      <p class="text-muted mb-0">
        By {{ review.user.username }} â€¢
        on {{ review.created_at|date:"Y-m-d H:i" }}
      </p>
    </header>

    <section class="movie-info card mb-4 {
      border: 1px solid #eaeaea;
    }">
      <div class="card-body">
        <h3 class="card-title mb-2">Movie</h3>
        
        <div class="movie-item mb-2">
          <h4 class="movie-title">{{ review.movie.title }}</h4>
          <p class="movie-genres mb-1">
            {% for genre in review.movie.genres.all %}
              {{ genre.name }}{% if not forloop.last %}, {% endif %}
            {% endfor %}
          </p>
          {% if review.movie.release_date %}
            <p class="movie-date text-muted">Released: {{ review.movie.release_date }}</p>
          {% endif %}
        </div>
      </div>
    </section>

    <section class="review-content card mb-4">
      <div class="card-body">
        <h3 class="card-title mb-2">Content</h3>
        <p class="card-text">{{ review.content }}</p>
      </div>
    </section>

    <section class="review-meta card mb-4">
      <div class="card-body">
        <h3 class="card-title mb-2">Rating</h3>
        <div class="d-flex align-items-center">
          {% include "reviews/rating_star.html" with value=review.rating %}
          <span class="ms-2 text-muted">{{ review.rating }}/5</span>
        </div>
      </div>
    </section>

    <section class="review-stats card mb-4">
      <div class="card-body d-flex gap-3">
        <span class="badge bg-primary">Likes: {{ review.reviews_like_set.count }}</span>
        <span class="badge bg-secondary">Flags: {{ review.reviewflag_set.count }}</span>
      </div>
    </section>

    <section class="review-actions d-flex gap-2">
      
      <a href="{% url 'reviews:like' review.pk %}" class="btn btn-outline-success">Like</a>
      <a href="{% url 'reviews:flag' review.pk %}" class="btn btn-outline-danger">Flag</a>
      {% if user.is_authenticated and user == review.user %}
        <a href="{% url 'reviews:update' review.pk %}" class="btn btn-outline-primary">Edit</a>
        <a href="{% url 'reviews:delete' review.pk %}" class="btn btn-outline-warning">Delete</a>
      {% endif %}
      <a href="{% url 'reviews:list' %}" class="btn btn-outline-secondary">Back to list</a>
    </section>
  </article>
{% endblock %}